# AI批改功能使用指南

## 📋 功能概述

本系统新增了AI自动批改简答题功能，支持：
- 语义理解（不要求字字匹配）
- 要点覆盖度分析
- 错误识别
- 生成个性化反馈
- 教师人工复核

## ⚙️ 配置步骤

### 1. 配置AI API

编辑 `config.py` 文件中的 `AI_GRADING_CONFIG` 部分：

```python
AI_GRADING_CONFIG = {
    'provider': 'openai',  # 或 'azure', 'anthropic', 'qianfan', 'tongyi'
    'api_key': 'your-api-key-here',  # 填写您的API密钥
    'base_url': 'https://api.openai.com/v1',  # API基础URL
    'model': 'gpt-3.5-turbo',  # 模型名称
    'enabled': True  # 启用AI批改
}
```

### 2. 支持的API提供商

- **OpenAI**: `provider: 'openai'`, 模型如 `gpt-3.5-turbo`, `gpt-4`
- **Azure OpenAI**: `provider: 'azure'`, 需配置 `base_url`
- **Anthropic Claude**: `provider: 'anthropic'`, 模型如 `claude-3-sonnet`
- **百度千帆**: `provider: 'qianfan'`
- **阿里通义**: `provider: 'tongyi'`

## 🎯 使用流程

### 教师端操作

1. **登录教师面板**
   - 使用管理员账户登录（默认：admin/admin）

2. **创建简答题题库**
   - 在题库管理中选择"简答题"标签
   - 点击"导入题库"，上传CSV格式的题库文件
   - CSV格式：题目内容,参考答案,分值,解析

3. **配置测试参数**
   - 在"设置测试参数"区域设置简答题数量和分值
   - 选择简答题题库
   - **重要**：在"简答题批改"选项中选择"AI批改"
   - 保存设置

4. **查看批改结果**
   - 在"测试统计"中查看学生答题情况
   - 点击学生姓名查看详细答题结果
   - 可以看到AI批改的分数、评语和原始反馈
   - 支持人工复核和修改分数

### 学生端操作

1. **参加测试**
   - 输入姓名和班级号开始测试
   - 正常答题，简答题支持文字和图片

2. **查看结果**
   - 提交后可立即看到AI批改的结果
   - 包含详细的评语和改进建议

## 🔍 AI批改特点

### 评分规则
- 每个要点按覆盖程度给分（完全覆盖100%，部分覆盖50%）
- 合理但不在参考答案中的内容，可适当加分
- 错误陈述不扣分，但会在反馈中指出

### 反馈内容
- **主要得分点**：分析学生答案的正确部分
- **扣分点**：指出不足和遗漏
- **改进建议**：提供具体的改进方向
- **拓展知识**：相关的知识点扩展

### 人工复核
- 教师可以查看AI的原始评分和反馈
- 支持修改AI给出的分数
- 可以添加或修改评语
- 复核后会标记为"已复核"

## 🧪 测试验证

### 1. 测试AI服务状态
```bash
python test_ai_grading.py
```

### 2. 测试完整流程
```bash
python test_full_ai_grading.py
```

### 3. 导入测试题库
使用提供的 `简答题测试题库.csv` 文件测试导入功能

## ⚠️ 注意事项

1. **API配置**
   - 确保API密钥有效且有足够的配额
   - 不同提供商的URL和模型名称不同

2. **网络连接**
   - AI批改需要网络连接到API服务
   - 如果网络不稳定，会自动重试

3. **降级处理**
   - 如果AI服务不可用，系统会自动切换到人工批改
   - 不会影响正常的测试流程

4. **数据安全**
   - 学生答案会发送到AI服务进行批改
   - 请确保符合数据隐私要求

## 🔧 故障排除

### AI批改不可用
1. 检查 `config.py` 中的 `enabled` 是否为 `True`
2. 验证 `api_key` 是否正确
3. 确认网络连接正常
4. 查看控制台日志错误信息

### 批改结果异常
1. 检查参考答案是否完整
2. 确认题目分值设置正确
3. 查看AI反馈中的错误信息

### 性能优化
1. 调整 `temperature` 参数控制回答稳定性
2. 设置合适的 `max_tokens` 限制
3. 配置 `timeout` 和 `max_retries` 参数

## 📞 技术支持

如遇到问题，请：
1. 查看控制台日志
2. 运行测试脚本诊断
3. 检查配置文件设置
4. 联系技术支持团队

---

**版本**: v1.0  
**更新日期**: 2024年12月  
**兼容性**: Python 3.7+, Flask 2.0+