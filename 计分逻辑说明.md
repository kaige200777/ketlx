# 计分逻辑说明

## 概述

系统中有两种分值设置：
1. **题库中每题的分值** - 在导入题库时设置，每道题可以有不同的分值
2. **教师面板设置的题型分值** - 在创建测试时设置，同一题型的所有题目使用相同分值

## 计分规则

### 1. 学生答题计分

**使用教师面板设置的题型分值**

当学生提交测试后，系统按以下规则计分：

- **单选题**：答对得 `test.single_choice_score` 分（教师设置）
- **多选题**：答对得 `test.multiple_choice_score` 分（教师设置）
- **判断题**：答对得 `test.true_false_score` 分（教师设置）
- **填空题**：答对得 `test.fill_blank_score` 分（教师设置）
- **简答题**：由教师批改或AI批改，最高 `test.short_answer_score` 分（教师设置）

**示例：**
```
教师设置：单选题 20道，每题 4分
题库中的题目：
  - 题目1：分值 3分
  - 题目2：分值 5分
  - 题目3：分值 4分

学生答题：
  - 题目1 答对 → 得 4分（使用教师设置的分值）
  - 题目2 答对 → 得 4分（使用教师设置的分值）
  - 题目3 答对 → 得 4分（使用教师设置的分值）
```

### 2. 总分计算

**使用教师面板设置的题型分值**

总分 = 各题型数量 × 各题型分值

```python
total_score = (
    single_choice_count * single_choice_score +
    multiple_choice_count * multiple_choice_score +
    true_false_count * true_false_score +
    fill_blank_count * fill_blank_score +
    short_answer_count * short_answer_score
)
```

**示例：**
```
教师设置：
  - 单选题：20道 × 4分 = 80分
  - 多选题：5道 × 5分 = 25分
  - 判断题：10道 × 3分 = 30分
  - 填空题：5道 × 5分 = 25分
  - 简答题：2道 × 10分 = 20分
  
总分 = 80 + 25 + 30 + 25 + 20 = 180分
```

### 3. 题库导出

**使用题库中每题的分值**

导出题库时，Excel文件中的"分值"列显示的是题库中每道题目自己的分值。

这样设计的原因：
- 题库是独立的资源，可以在不同测试中复用
- 题库中的分值是题目的"建议分值"
- 教师可以根据实际需要调整测试中的分值

**示例：**

导出的Excel文件：
```
题目                    | 选项A | 选项B | 选项C | 选项D | 正确答案 | 分值 | 解析
------------------------|-------|-------|-------|-------|----------|------|------
计算机的核心部件是？    | CPU   | 内存  | 硬盘  | 显卡  | A        | 3    | ...
下列哪个是输入设备？    | 显示器| 键盘  | 音箱  | 打印机| B        | 5    | ...
```

## 代码实现位置

### 1. 学生答题计分
**文件**: `app.py`  
**函数**: `submit_test()`  
**代码行**: 约 464-600

```python
# 单选题计分
if question.question_type == 'single_choice':
    if answer == question.correct_answer:
        score = test_config.single_choice_score  # 使用教师设置的分值
        total_score += score or 0
```

### 2. 总分计算
**文件**: `app.py`  
**函数**: `save_test_settings()`  
**代码行**: 约 1960-1970

```python
# 自动计算总分
total_score = (
    single_choice_count * single_choice_score +
    multiple_choice_count * multiple_choice_score +
    true_false_count * true_false_score +
    fill_blank_count * fill_blank_score +
    short_answer_count * short_answer_score
)
```

### 3. 测试结果显示
**文件**: `app.py`  
**函数**: `test_result()`  
**代码行**: 约 1050-1070

```python
# 显示每题得分
if question.question_type == 'single_choice':
    is_correct = answer == question.correct_answer
    score = test.single_choice_score if is_correct else 0  # 使用教师设置的分值
```

### 4. 题库导出
**文件**: `app.py`  
**函数**: `export_bank()`  
**代码行**: 约 1520-1540

```python
# 导出题库时使用题库中的分值
data.append({
    '题目': q.content,
    '选项A': q.option_a or '',
    # ...
    '分值': q.score,  # 使用题库中的分值
    '解析': q.explanation or ''
})
```

## 设计理念

### 为什么这样设计？

1. **灵活性**
   - 同一个题库可以在不同测试中使用不同的分值
   - 教师可以根据测试难度调整分值

2. **一致性**
   - 同一测试中，同一题型的所有题目分值相同
   - 避免因题目难度不同导致的不公平

3. **可维护性**
   - 题库中的分值是"建议值"，不影响实际测试
   - 修改测试分值不需要修改题库

### 使用场景

**场景1：期中考试**
```
教师设置：
  - 单选题：30道 × 2分 = 60分
  - 简答题：2道 × 20分 = 40分
总分：100分
```

**场景2：期末考试（使用相同题库）**
```
教师设置：
  - 单选题：30道 × 3分 = 90分
  - 简答题：2道 × 30分 = 60分
总分：150分
```

## 常见问题

### Q1: 为什么题库中的分值和测试中的分值不一样？
**A:** 题库中的分值是"建议分值"，实际测试使用教师在面板中设置的分值。这样设计是为了让同一题库可以在不同测试中灵活使用。

### Q2: 如何修改测试中的分值？
**A:** 在教师控制面板的"设置测试参数"中，修改各题型的"分值"输入框，然后点击"保存设置"。

### Q3: 导出的题库可以重新导入吗？
**A:** 可以。导出的Excel文件保留了题库中的原始分值，重新导入后分值会保持不变。

### Q4: 学生能看到题库中的分值吗？
**A:** 不能。学生只能看到测试结果中的得分，这个得分是按教师设置的分值计算的。

### Q5: 如何让题库分值和测试分值一致？
**A:** 在导入题库时，确保所有题目的分值相同。然后在创建测试时，设置相同的分值即可。

## 总结

- ✅ **学生答题计分**：使用教师面板设置的题型分值
- ✅ **总分计算**：使用教师面板设置的题型分值
- ✅ **测试结果显示**：使用教师面板设置的题型分值
- ✅ **题库导出**：使用题库中每题的分值

这种设计既保证了测试的公平性和一致性，又保留了题库的灵活性和可复用性。

---
**最后更新**: 2025-12-12
