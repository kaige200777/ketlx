# 填空题计分显示改进

## 改进内容

### 修改前
填空题在测试结果页面只显示"对"或"错"，无法看到具体得分。

### 修改后
填空题显示具体得分，并根据得分情况显示不同的状态标签。

## 计分规则

### 1. 按空格计分
填空题按每个空格平均分配分数：

```
每空分数 = 题目总分 ÷ 空格数量
```

**示例：**
- 题目总分：10分
- 空格数量：4个
- 每空分数：2.5分

### 2. 部分得分
学生可以获得部分分数：

- 答对1个空格：得 2.5分
- 答对2个空格：得 5分
- 答对3个空格：得 7.5分
- 答对4个空格：得 10分（满分）

## 显示效果

### 1. 题目卡片头部

**全对（满分）：**
```
第1题  [得分：10分] (绿色徽章)
```

**部分正确：**
```
第1题  [得分：5分] (黄色徽章)
```

**全错（0分）：**
```
第1题  [得分：0分] (红色徽章)
```

### 2. 答案详情区域

显示内容：
- 你的答案
- 正确答案
- **得分**：X分（带颜色）
- **状态标签**：
  - 全对（绿色）
  - 部分正确（黄色）
  - 全错（红色）

## 代码修改

### 1. 后端计分逻辑 (app.py)

**位置**: `test_result()` 函数

**修改内容**:
```python
elif question.question_type == 'fill_blank':
    # 处理填空题多个答案，按每个空格计分
    correct_fill_ins = [f.strip().lower() for f in question.correct_answer.split('、') if f.strip()]
    student_fill_ins = [f.strip().lower() for f in answer.split('、') if f.strip()]
    num_fill_ins = len(correct_fill_ins)
    
    if num_fill_ins > 0:
        score_per_fill_in = round(test.fill_blank_score / num_fill_ins, 1)
        score = 0
        
        # 比较每个填空
        for i in range(min(len(student_fill_ins), num_fill_ins)):
            if student_fill_ins[i] == correct_fill_ins[i]:
                score += score_per_fill_in
        
        # 判断是否全对
        is_correct = (score == test.fill_blank_score)
    else:
        score = 0
        is_correct = False
```

### 2. 前端显示 (test_result.html)

**位置1**: 题目卡片头部徽章

```html
{% elif question.question_type == 'fill_blank' %}
<span class="badge {% if question.is_correct %}bg-success{% elif question.score > 0 %}bg-warning{% else %}bg-danger{% endif %}">
    得分：{{ question.score }}分
</span>
```

**位置2**: 答案详情区域

```html
<div class="mt-2">
    <strong>得分：</strong>
    <span class="{% if question.is_correct %}text-success{% elif question.score > 0 %}text-warning{% else %}text-danger{% endif %}">
        {{ question.score }}分
    </span>
    {% if question.is_correct %}
    <span class="badge bg-success ms-2">全对</span>
    {% elif question.score > 0 %}
    <span class="badge bg-warning ms-2">部分正确</span>
    {% else %}
    <span class="badge bg-danger ms-2">全错</span>
    {% endif %}
</div>
```

## 颜色说明

- **绿色** (bg-success / text-success): 全对，得满分
- **黄色** (bg-warning / text-warning): 部分正确，得部分分
- **红色** (bg-danger / text-danger): 全错，得0分

## 示例场景

### 场景1：4个空格的填空题

**题目设置：**
- 总分：10分
- 空格数：4个
- 每空：2.5分

**学生答案：**
```
正确答案：CPU、内存、硬盘、显卡
学生答案：CPU、内存、硬盘、鼠标
```

**显示结果：**
- 得分：7.5分
- 状态：部分正确（黄色）
- 说明：答对3个空格（CPU、内存、硬盘），错1个（显卡）

### 场景2：2个空格的填空题

**题目设置：**
- 总分：6分
- 空格数：2个
- 每空：3分

**学生答案：**
```
正确答案：北京、上海
学生答案：北京、上海
```

**显示结果：**
- 得分：6分
- 状态：全对（绿色）

### 场景3：全错的情况

**学生答案：**
```
正确答案：北京、上海
学生答案：广州、深圳
```

**显示结果：**
- 得分：0分
- 状态：全错（红色）

## 优势

1. **更精确的反馈**
   - 学生可以清楚看到自己得了多少分
   - 知道哪些空格答对了，哪些答错了

2. **更公平的评分**
   - 部分正确也能得到相应的分数
   - 避免"全对或全错"的极端情况

3. **更好的学习体验**
   - 通过颜色和标签快速识别答题情况
   - 鼓励学生继续努力

## 注意事项

1. **分数精度**
   - 每空分数保留1位小数
   - 例如：10分÷3个空 = 3.3分/空

2. **答案顺序**
   - 填空题答案必须按顺序填写
   - 第1个空对应第1个答案，第2个空对应第2个答案

3. **大小写不敏感**
   - 答案比较时会转换为小写
   - "CPU" 和 "cpu" 视为相同答案

4. **空格分隔符**
   - 使用顿号（、）分隔多个答案
   - 例如：CPU、内存、硬盘

## 兼容性

- ✅ 不影响其他题型的显示
- ✅ 向后兼容已有的测试结果
- ✅ 支持所有浏览器

---
**更新时间**: 2025-12-12  
**版本**: v1.1.0
