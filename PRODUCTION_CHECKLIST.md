# 生产环境部署检查清单

## 部署前检查

### 环境准备
- [ ] Python 3.8+ 已安装
- [ ] 虚拟环境已创建并激活
- [ ] 所有依赖已安装 (`pip install -r requirements.txt`)
- [ ] 服务器有足够的磁盘空间（至少 10GB）
- [ ] 服务器有足够的内存（至少 2GB）

### 安全配置
- [ ] 已修改 `app.py` 中的 `SECRET_KEY` 为强随机密钥
- [ ] 已修改默认管理员密码（admin/admin）
- [ ] 已配置防火墙规则
- [ ] 已禁用 Flask 调试模式（`debug=False`）
- [ ] 已配置 HTTPS（推荐）

### 数据库
- [ ] 已运行 `python init_database.py` 初始化数据库
- [ ] 数据库文件有正确的读写权限
- [ ] 已配置数据库自动备份
- [ ] 已测试数据库连接

### 文件系统
- [ ] `static/uploads` 目录存在且有写权限
- [ ] `instance` 目录存在且有写权限
- [ ] 已清理临时测试文件
- [ ] 已移动文档到 `docs/` 目录

### 应用配置
- [ ] 已检查 `app.py` 中的所有配置项
- [ ] 图片上传限制已配置（类型、大小）
- [ ] 时区设置正确（北京时间 UTC+8）
- [ ] 已配置日志输出

## 部署检查

### 应用启动
- [ ] 应用可以正常启动
- [ ] 没有启动错误或警告
- [ ] 端口没有被占用
- [ ] 进程管理器已配置（Supervisor/systemd）

### 功能测试
- [ ] 教师可以正常登录
- [ ] 学生可以正常登录
- [ ] 可以创建题库
- [ ] 可以导入题目（Excel）
- [ ] 可以创建测试配置
- [ ] 可以保存测试预设
- [ ] 学生可以参加测试
- [ ] 学生可以提交答案
- [ ] 可以查看测试结果
- [ ] 教师可以评分简答题
- [ ] 可以查看统计数据

### 性能测试
- [ ] 页面加载速度正常（< 3秒）
- [ ] 图片上传功能正常
- [ ] 多用户并发测试通过
- [ ] 数据库查询性能正常

### 安全测试
- [ ] 未授权访问被正确拦截
- [ ] 学生无法访问教师功能
- [ ] 文件上传类型限制有效
- [ ] 文件大小限制有效
- [ ] SQL 注入防护有效
- [ ] XSS 防护有效

## 部署后检查

### 监控设置
- [ ] 应用日志正常输出
- [ ] 错误日志可以查看
- [ ] 已配置日志轮转
- [ ] 已设置监控告警（可选）

### 备份配置
- [ ] 数据库自动备份已配置
- [ ] 备份脚本测试通过
- [ ] 备份文件可以正常恢复
- [ ] 已配置异地备份（推荐）

### 文档准备
- [ ] 已准备用户使用手册
- [ ] 已准备管理员操作指南
- [ ] 已记录所有配置信息
- [ ] 已准备故障排查文档

### 用户培训
- [ ] 教师已接受系统培训
- [ ] 教师知道如何创建题库
- [ ] 教师知道如何配置测试
- [ ] 教师知道如何查看统计
- [ ] 学生知道如何登录和测试

## 上线检查

### 最终确认
- [ ] 所有功能测试通过
- [ ] 所有安全检查通过
- [ ] 性能测试达标
- [ ] 备份系统正常工作
- [ ] 监控系统正常工作
- [ ] 用户培训完成

### 上线准备
- [ ] 已通知所有用户上线时间
- [ ] 已准备回滚方案
- [ ] 已准备应急联系方式
- [ ] 已准备技术支持团队

### 上线后
- [ ] 监控应用运行状态
- [ ] 检查错误日志
- [ ] 收集用户反馈
- [ ] 记录遇到的问题
- [ ] 准备第一次数据备份

## 常见问题快速检查

### 应用无法启动
```bash
# 检查 Python 版本
python --version

# 检查依赖
pip list

# 检查端口占用
netstat -ano | findstr :5000  # Windows
lsof -i :5000                 # Linux/Mac

# 检查数据库
ls -l instance/test_system.db
```

### 学生无法登录
```bash
# 检查是否有激活的测试
python -c "from app import app, Test; \
with app.app_context(): \
    print('激活的测试:', Test.query.filter_by(is_active=True).count())"
```

### 图片上传失败
```bash
# 检查上传目录
ls -ld static/uploads

# 检查权限
chmod 755 static/uploads  # Linux/Mac
```

## 维护计划

### 每日
- [ ] 检查应用运行状态
- [ ] 查看错误日志
- [ ] 监控磁盘空间

### 每周
- [ ] 检查数据库大小
- [ ] 清理临时文件
- [ ] 检查备份文件

### 每月
- [ ] 更新系统依赖
- [ ] 优化数据库
- [ ] 审查安全日志
- [ ] 测试备份恢复

### 每季度
- [ ] 进行全面安全审计
- [ ] 更新文档
- [ ] 收集用户反馈
- [ ] 规划功能改进

## 紧急联系

### 技术支持
- 系统管理员：[联系方式]
- 数据库管理员：[联系方式]
- 网络管理员：[联系方式]

### 应急流程
1. 发现问题
2. 记录错误信息
3. 联系技术支持
4. 如需要，执行回滚
5. 问题解决后，记录处理过程

## 签字确认

| 检查项 | 负责人 | 日期 | 签字 |
|--------|--------|------|------|
| 环境准备 | | | |
| 安全配置 | | | |
| 功能测试 | | | |
| 性能测试 | | | |
| 备份配置 | | | |
| 用户培训 | | | |
| 最终上线 | | | |

---

**注意：** 请在完成每项检查后打勾，确保所有项目都已完成再上线。
