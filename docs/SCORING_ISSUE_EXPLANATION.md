# 多选题得分为0的问题说明

## 问题描述

在测试结果页面（如 `/test_result/13`），第一题是多选题，学生答案是 ABD，正确答案也是 ABD，但得分显示为 0。

## 问题分析

通过调试发现：

### 1. 学生答案是正确的

```
题目 ID: 393
题型: multiple_choice
学生答案: 'A,B,D'
正确答案: 'ABD'
标准化学生答案: 'ABD'
标准化正确答案: 'ABD'
是否相等: True
```

### 2. 评分逻辑是正确的

```python
elif question.question_type == 'multiple_choice':
    def normalize(ans):
        return ''.join(sorted([c for c in ans.replace(',', '').replace(' ', '').upper() if c in 'ABCDE']))
    is_correct = normalize(answer) == normalize(question.correct_answer)
    score = test.multiple_choice_score if is_correct else 0
```

`is_correct` 被正确设置为 `True`。

### 3. 问题根源：测试配置中多选题分数为 0

```
测试 ID: 16
测试标题: 月考
单选题分数: 4
多选题分数: 0  ← 这里是问题所在
判断题分数: 3
填空题分数: 9
简答题分数: 10
总分: 50
```

## 问题原因

**教师在创建/编辑测试时，将多选题的每题分数设置为了 0。**

这不是系统的 bug，而是测试配置的问题。

## 解决方案

### 方案1：修改测试配置（推荐）

教师需要：
1. 登录教师面板
2. 重新设置测试参数
3. 将"多选题每题分数"设置为合适的值（如 5 分）
4. 保存设置

### 方案2：重新计算已有测试结果的分数

如果需要修正已经提交的测试结果，可以：

1. 创建一个脚本重新计算分数
2. 使用正确的分数配置
3. 更新 `TestResult` 表中的 `score` 字段

**注意**：这需要谨慎操作，建议备份数据库。

## 显示逻辑验证

在测试结果页面：
- **徽章显示**：因为 `is_correct = True`，所以显示绿色"对"徽章 ✓
- **得分显示**：因为 `test.multiple_choice_score = 0`，所以得分为 0

这是符合预期的行为：答对了，但因为该题型分数设置为 0，所以不得分。

## 建议

为了避免混淆，可以考虑：

1. **在教师面板添加验证**：
   - 如果某个题型的题目数量 > 0，但分数 = 0，显示警告
   - 提示教师检查分数设置

2. **在学生结果页面添加说明**：
   - 如果答对了但得分为 0，显示提示信息
   - 例如："此题答对，但该题型分数设置为 0"

## 总结

- ✅ 评分逻辑正确
- ✅ 答案判断正确
- ✅ 显示逻辑正确
- ❌ 测试配置中多选题分数设置为 0（需要教师修改）

这不是系统 bug，而是测试配置的问题。
