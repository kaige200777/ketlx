# 课堂测试系统调试需求文档

## 简介

本文档定义了对现有课堂测试系统进行调试和改进的需求。系统是一个基于 Flask 的在线测试平台，支持教师端题库管理和学生端在线测试功能。

## 术语表

- **系统 (System)**: 指课堂测试系统应用程序
- **教师端 (Teacher Interface)**: 教师使用的管理界面
- **学生端 (Student Interface)**: 学生使用的测试界面
- **题库 (Question Bank)**: 存储题目的数据库集合
- **测试配置 (Test Configuration)**: 定义测试参数的设置
- **测试结果 (Test Result)**: 学生完成测试后的成绩记录

## 需求

### 需求 1: 数据库初始化

**用户故事**: 作为系统管理员，我希望系统能够正确初始化数据库，以便应用程序可以正常运行。

#### 验收标准

1. WHEN 系统首次启动 THEN 系统 SHALL 自动创建所有必需的数据库表
2. WHEN 数据库表不存在 THEN 系统 SHALL 创建默认的教师账户（用户名: admin, 密码: admin）
3. WHEN 数据库已存在 THEN 系统 SHALL 跳过初始化并使用现有数据
4. WHEN 数据库初始化失败 THEN 系统 SHALL 记录错误信息并提供清晰的错误提示

### 需求 2: 题库导入功能

**用户故事**: 作为教师，我希望能够批量导入题目，以便快速建立题库。

#### 验收标准

1. WHEN 教师上传 CSV 文件 THEN 系统 SHALL 正确解析 UTF-8 编码的文件内容
2. WHEN 教师上传 Excel 文件 THEN 系统 SHALL 正确解析 .xlsx 格式的文件
3. WHEN 文件格式不正确 THEN 系统 SHALL 显示具体的错误信息
4. WHEN 导入成功 THEN 系统 SHALL 显示导入的题目数量
5. WHEN 题目包含图片路径 THEN 系统 SHALL 正确存储图片引用
6. WHEN 导入单选题 THEN 系统 SHALL 要求文件包含列名：题干、选项A、选项B、选项C、选项D、正确答案、分值、答案解析
7. WHEN 导入多选题 THEN 系统 SHALL 要求文件包含列名：题干、选项A、选项B、选项C、选项D、选项E、正确答案、分值、解析
8. WHEN 导入判断题 THEN 系统 SHALL 要求文件包含列名：题干、正确答案、分值、解析
9. WHEN 导入填空题 THEN 系统 SHALL 要求文件包含列名：题干、正确答案、分值、解析
10. WHEN 导入简答题 THEN 系统 SHALL 要求文件包含列名：题目内容、参考答案、分值、解析
11. WHEN 文件列名不匹配题型要求 THEN 系统 SHALL 显示缺失或错误的列名信息

### 需求 3: 测试配置管理

**用户故事**: 作为教师，我希望能够灵活配置测试参数，以便适应不同的教学需求。

#### 验收标准

1. WHEN 教师设置测试参数 THEN 系统 SHALL 验证所有必填字段已填写
2. WHEN 教师选择题库 THEN 系统 SHALL 验证题库中有足够的题目
3. WHEN 教师保存配置 THEN 系统 SHALL 自动计算总分
4. WHEN 教师点击保存设置 THEN 系统 SHALL 自动使用测试标题作为预设名称保存配置
5. WHEN 预设保存成功 THEN 系统 SHALL 在预设下拉列表中显示该预设
6. WHEN 教师选择预设 THEN 系统 SHALL 加载该预设的所有配置参数
7. WHEN 教师选择预设 THEN 系统 SHALL 启用删除按钮
8. WHEN 教师点击删除按钮 THEN 系统 SHALL 删除选中的预设并刷新预设列表
9. WHEN 没有选择预设 THEN 系统 SHALL 禁用删除按钮
10. WHEN 学生自选功能启用 THEN 系统 SHALL 在学生端显示可选的测试内容

### 需求 4: 学生测试流程

**用户故事**: 作为学生，我希望能够顺利完成在线测试，以便评估我的学习成果。

#### 验收标准

1. WHEN 学生输入姓名和班级号 THEN 系统 SHALL 自动创建或登录学生账户
2. WHEN 学生开始测试 THEN 系统 SHALL 从配置的题库中随机抽取题目
3. WHEN 学生答题 THEN 系统 SHALL 正确保存所有类型题目的答案
4. WHEN 学生提交测试 THEN 系统 SHALL 自动评分并保存结果
5. WHEN 测试包含简答题 THEN 系统 SHALL 允许学生上传图片作为答案

### 需求 5: 成绩统计功能

**用户故事**: 作为教师，我希望能够查看详细的测试统计数据，以便分析学生的学习情况。

#### 验收标准

1. WHEN 教师查看统计 THEN 系统 SHALL 显示所有测试的成绩列表
2. WHEN 教师选择特定测试 THEN 系统 SHALL 显示该测试的详细统计信息
3. WHEN 显示班级统计 THEN 系统 SHALL 计算平均分、最高分、最低分和及格率
4. WHEN 显示错题统计 THEN 系统 SHALL 按错误率排序显示前10道错题
5. WHEN 教师查看学生答题详情 THEN 系统 SHALL 显示每道题的答案和正确性

### 需求 6: 简答题人工批改

**用户故事**: 作为教师，我希望能够在测试统计中查看学生答题详情并对简答题进行人工打分，以便给学生提供准确的评分和反馈。

#### 验收标准

1. WHEN 教师在测试统计页面点击学生记录 THEN 系统 SHALL 显示该学生的完整答题详情
2. WHEN 答题详情包含简答题 THEN 系统 SHALL 显示学生的文字答案和上传的图片
3. WHEN 教师为简答题输入分数和评语 THEN 系统 SHALL 验证分数在有效范围内
4. WHEN 教师保存简答题评分 THEN 系统 SHALL 立即保存评分和评语到数据库
5. WHEN 简答题评分保存成功 THEN 系统 SHALL 重新计算该学生的测试总分
6. WHEN 测试总分更新 THEN 系统 SHALL 同步更新学生的历史统计数据（平均分、最高分、最低分）
7. WHEN 教师完成批改返回统计页面 THEN 系统 SHALL 显示更新后的成绩
8. WHEN 学生查看测试结果 THEN 系统 SHALL 显示教师给出的简答题分数和评语
9. WHEN 简答题未批改 THEN 系统 SHALL 在答题详情中标记为"待批改"状态
10. WHEN 多个简答题需要批改 THEN 系统 SHALL 允许教师逐题批改并实时更新总分

### 需求 7: 错误处理和用户体验

**用户故事**: 作为用户，我希望系统能够优雅地处理错误，以便获得良好的使用体验。

#### 验收标准

1. WHEN 发生数据库错误 THEN 系统 SHALL 回滚事务并显示友好的错误信息
2. WHEN 用户输入无效数据 THEN 系统 SHALL 显示具体的验证错误信息
3. WHEN 文件上传失败 THEN 系统 SHALL 提示用户检查文件格式和大小
4. WHEN 会话过期 THEN 系统 SHALL 重定向到登录页面
5. WHEN 权限不足 THEN 系统 SHALL 显示权限错误并阻止访问

### 需求 8: 学生历史答题查看

**用户故事**: 作为学生，我希望在测试完成后能够浏览自己的历次答题情况，以便回顾学习进度和错题。

#### 验收标准

1. WHEN 学生完成测试提交后 THEN 系统 SHALL 在学生面板显示历次测试记录列表
2. WHEN 学生点击某次测试记录 THEN 系统 SHALL 显示该次测试的完整答题详情
3. WHEN 显示答题详情 THEN 系统 SHALL 展示每道题的题目、学生答案、正确答案和得分情况
4. WHEN 题目答错 THEN 系统 SHALL 用明显的标记区分正确和错误的答案
5. WHEN 题目有解析 THEN 系统 SHALL 显示题目的解析内容
6. WHEN 简答题已批改 THEN 系统 SHALL 显示教师给出的分数和评语
7. WHEN 简答题未批改 THEN 系统 SHALL 显示"待批改"状态
8. WHEN 学生查看历史记录 THEN 系统 SHALL 按时间倒序显示测试记录
9. WHEN 学生查看统计信息 THEN 系统 SHALL 显示总测试次数、平均分、最高分和最低分

### 需求 9: 时区处理

**用户故事**: 作为用户，我希望看到正确的本地时间，以便准确了解测试时间。

#### 验收标准

1. WHEN 系统存储时间戳 THEN 系统 SHALL 使用 UTC 时间存储
2. WHEN 系统显示时间 THEN 系统 SHALL 转换为北京时间（UTC+8）
3. WHEN 时间格式化 THEN 系统 SHALL 使用统一的时间格式
4. WHEN 时间为空 THEN 系统 SHALL 正确处理空值情况
